"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),require("../../constants/envVariables.js");var e=require("../../constants/numbers.js"),t=require("../../errors/errors.js"),a=require("../position/types.js");require("big.js");var r=require("../../utils/errorChecker.js");require("ethers"),require("../../utils/tick.js"),exports.getBuyingPower=function({imRatio:i,freeCollateral:n,existingPositionValue:o=e.BIG_ZERO,side:l,nextFreeCollateral:s}){r.invariant(!i.eq(0),(()=>new t.FailedPreconditionError({functionName:"getBuyingPower",stateName:"imRatio",stateValue:"zero"})));const u=!o.eq(0);let d,c;if(u){d=(o.gt(0)?a.PositionSide.LONG:a.PositionSide.SHORT)===l}return c=!u||d?n.div(i):o.abs().add(s.div(i)),c},exports.getNextAccountValue=function({indexTwapPrice:e,accountValue:t,signedDeltaAvailableBase:a,signedDeltaAvailableQuote:r}){const i=a.mul(e).add(r);return t.add(i)},exports.getNextFreeCollateral=function({nextTotalCollateralValue:e,nextAccountValue:t,nextOpenOrderMarginReq:a}){return(e.gt(t)?t:e).sub(a)},exports.getNextOpenOrderMarginReq=function({sumOfOtherBaseDebtValue:t,sumOfQuoteDebtValue:a,thisBaseBalance:r,signedDeltaAvailableBase:i,signedDeltaAvailableQuote:n,indexTwapPrice:o,imRatio:l}){const s=r.add(i),u=s.lt(0)?s.abs():e.BIG_ZERO,d=a.add(n),c=d.lt(0)?d.abs():e.BIG_ZERO;return t.add(u.mul(o)).add(c).mul(l)},exports.getNextTotalCollateralValue=function({nextAccountValue:e,signedDeltaAvailableBase:t,signedDeltaAvailableQuote:a,indexTwapPrice:r,totalUnrealizedPNLFromAllMarkets:i}){const n=i.add(t.mul(r).add(a));return e.sub(n)},exports.getPriceImpact=function({price:e,markPrice:t}){return e.div(t).sub(1)},exports.getSwapRate=function({amountBase:e,amountQuote:t}){return t.div(e).abs()},exports.getTransactionFee=function({isBaseToQuote:e,exchangedPositionNotional:t,deltaAvailableQuote:a,feeRatio:r}){return e?t.mul(r):a.mul(r)},exports.getUnrealizedPnl=function({isLong:e,openNotionalAbs:t,deltaAvailableQuote:a}){return e?a.sub(t):t.sub(a)};
//# sourceMappingURL=utils.js.map
