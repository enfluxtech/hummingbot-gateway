"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.printCall = void 0;
const utils_1 = require("ethers/lib/utils");
const colors_1 = require("../colors");
const constants_1 = require("../constants");
const utils_2 = require("../utils");
const call_1 = require("../format/call");
const gas_cost_1 = require("../format/gas-cost");
async function printCall(structLog, index, structLogs, dependencies) {
    const stack = (0, utils_2.shallowCopyStack)(structLog.stack);
    if (stack.length < 7) {
        console.log("Faulty CALL");
        return;
    }
    const gas = (0, utils_2.parseUint)(stack.pop());
    const to = (0, utils_2.parseAddress)(stack.pop());
    const value = (0, utils_2.parseUint)(stack.pop());
    const argsOffset = (0, utils_2.parseNumber)(stack.pop());
    const argsSize = (0, utils_2.parseNumber)(stack.pop());
    const retOffset = (0, utils_2.parseNumber)(stack.pop());
    const retSize = (0, utils_2.parseNumber)(stack.pop());
    const memory = (0, utils_2.parseMemory)(structLog.memory);
    const input = (0, utils_1.hexlify)(memory.slice(argsOffset, argsOffset + argsSize));
    // return data
    const [structLogNext, structLogNextNext] = (0, utils_2.findNextStructLogInDepth)(structLogs, structLog.depth, index + 1 // find next structLog in the same depth
    );
    const ret = (0, utils_1.hexlify)((0, utils_2.parseMemory)(structLogNext.memory).slice(retOffset, retOffset + retSize));
    const str = await (0, call_1.formatCall)(to, input, ret, value, gas, dependencies);
    console.log(constants_1.DEPTH_INDENTATION.repeat(structLog.depth) +
        (0, colors_1.colorLabel)("CALL") +
        " " +
        str +
        (0, gas_cost_1.formatGasCost)(structLog, structLog.gas - structLogNextNext.gas, dependencies));
    return to;
}
exports.printCall = printCall;
//# sourceMappingURL=call.js.map