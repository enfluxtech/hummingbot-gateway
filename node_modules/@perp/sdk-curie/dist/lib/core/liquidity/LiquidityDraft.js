"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("ethers");require("../../constants/envVariables.js");var t=require("../../constants/numbers.js");require("big.js");var i=require("../../utils/formatters.js"),r=require("../../utils/tick.js"),a=require("./LiquidityBase.js");const s=i.bigNumber2BigAndScaleDown(e.constants.MaxUint256,1);class c extends a.LiquidityBase{constructor({perp:e,market:t,lowerTick:i,upperTick:r,rawBaseAmount:a,rawQuoteAmount:s}){super({market:t},e.channelRegistry),this._perp=e,this._lowerTick=i,this._upperTick=r,this.rawBaseAmount=a,this.rawQuoteAmount=s}async getLiquidity({cache:e=!0}={}){const[{markPrice:o},u]=await Promise.all([this.market.getPrices({cache:e}),this.getRangeType({cache:e})]),n=i.toSqrtX96(o),T=r.tickToPrice(this._lowerTick),h=r.tickToPrice(this._upperTick),k=i.toSqrtX96(T),m=i.toSqrtX96(h);switch(u){case a.RangeType.RANGE_AT_LEFT:return this.rawQuoteAmount?c.maxLiquidityForAmounts(n,k,m,s,this.rawQuoteAmount):t.BIG_ZERO;case a.RangeType.RANGE_AT_RIGHT:return this.rawBaseAmount?c.maxLiquidityForAmounts(n,k,m,this.rawBaseAmount,s):t.BIG_ZERO;case a.RangeType.RANGE_INSIDE:return this.rawBaseAmount||this.rawQuoteAmount?c.maxLiquidityForAmounts(n,k,m,this.rawBaseAmount||s,this.rawQuoteAmount||s):t.BIG_ZERO;default:return t.BIG_ZERO}}async getBaseAmount({cache:e=!0}={}){const s=await this.getRangeType({cache:e}),o=await this.getLiquidity(),{markPrice:u}=await this.market.getPrices(),n=i.toSqrtX96(u),T=r.tickToPrice(this._lowerTick),h=i.toSqrtX96(T),k=r.tickToPrice(this._upperTick),m=i.toSqrtX96(k);let A=t.BIG_ZERO;switch(s){case a.RangeType.RANGE_AT_RIGHT:A=c.getBaseTokenAmountFromLiquidity(h,m,o);break;case a.RangeType.RANGE_INSIDE:A=c.getBaseTokenAmountFromLiquidity(n,m,o);break;case a.RangeType.RANGE_AT_LEFT:A=t.BIG_ZERO}return A}async getQuoteAmount({cache:e=!0}={}){const s=await this.getRangeType({cache:e}),o=await this.getLiquidity(),{markPrice:u}=await this.market.getPrices(),n=i.toSqrtX96(u),T=r.tickToPrice(this._lowerTick),h=i.toSqrtX96(T),k=r.tickToPrice(this._upperTick),m=i.toSqrtX96(k);let A=t.BIG_ZERO;switch(s){case a.RangeType.RANGE_AT_LEFT:A=c.getQuoteTokenAmountFromLiquidity(h,m,o);break;case a.RangeType.RANGE_INSIDE:A=c.getQuoteTokenAmountFromLiquidity(n,h,o);break;case a.RangeType.RANGE_AT_RIGHT:A=t.BIG_ZERO}return A}getTickPrices(){return{lowerTickPrice:r.tickToPrice(this._lowerTick),upperTickPrice:r.tickToPrice(this._upperTick)}}}exports.LiquidityDraft=c;
//# sourceMappingURL=LiquidityDraft.js.map
