import{Channel as t}from"../../internal/Channel.js";import{ChannelEventSource as e}from"../../internal/ChannelEventSource.js";import"../../constants/envVariables.js";import{Q96 as r}from"../../constants/numbers.js";import"big.js";import"ethers";import{TICK_MIN as i,TICK_MAX as u,tickToPrice as n}from"../../utils/tick.js";var o;!function(t){t.RANGE_UNINITIALIZED="RANGE_UNINITIALIZED",t.RANGE_INVALID="RANGE_INVALID",t.RANGE_INSIDE="RANGE_INSIDE",t.RANGE_AT_LEFT="RANGE_AT_LEFT",t.RANGE_AT_RIGHT="RANGE_AT_RIGHT"}(o||(o={}));class s extends t{constructor({market:t},e){super(e),this._lowerTick=i,this._upperTick=u,this.market=t}get lowerTick(){return this._lowerTick}get upperTick(){return this._upperTick}get lowerTickPrice(){return n(this._lowerTick)}get upperTickPrice(){return n(this._upperTick)}async getRangeType({cache:t=!0}={}){const{markPrice:e}=await this.market.getPrices({cache:t});return s.getRangeTypeByMarkPrice(e,this.lowerTickPrice,this.upperTickPrice)}_getEventSourceMap(){const t=new e({eventSourceStarter:()=>this.market.on("updated",(()=>this.emit("updated",this)))});return{updated:t,updateError:t}}static getRangeTypeByMarkPrice(t,e,r){return r.lte(e)?o.RANGE_INVALID:t.gte(r)?o.RANGE_AT_LEFT:t.lte(e)?o.RANGE_AT_RIGHT:o.RANGE_INSIDE}static getLiquidityFromBaseToken(t,e,i){const u=i.mul(t).mul(e),n=r.mul(e.sub(t));return u.div(n)}static getLiquidityFromQuoteToken(t,e,i){const u=i.mul(r),n=t.sub(e);return u.div(n)}static getBaseTokenAmountFromLiquidity(t,e,i){const[u,n]=t.lt(e)?[t,e]:[e,t],o=i.mul(r),s=n.sub(u),c=o.mul(s),a=n.mul(u);return c.div(a)}static getQuoteTokenAmountFromLiquidity(t,e,i){const[u,n]=t.lt(e)?[t,e]:[e,t],o=i.mul(n.sub(u)),s=r;return o.div(s)}static maxLiquidityForAmounts(t,e,r,i,u){if(e.gt(r)&&([e,r]=[r,e]),t.lte(e))return s.getLiquidityFromBaseToken(e,r,i);if(t.lt(r)){const n=s.getLiquidityFromBaseToken(t,r,i),o=s.getLiquidityFromQuoteToken(t,e,u);return n.lt(o)?n:o}return s.getLiquidityFromQuoteToken(r,e,u)}}export{s as LiquidityBase,o as RangeType};
//# sourceMappingURL=LiquidityBase.js.map
