!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("near-api-js"),require("bn.js"),require("mathjs"),require("fs"),require("os"),require("big.js"),require("lodash-es")):"function"==typeof define&&define.amd?define(["exports","near-api-js","bn.js","mathjs","fs","os","big.js","lodash-es"],t):t((e=e||self)["coinalpha-ref-sdk"]={},e.nearApiJs,e.BN,e.math,e.fs,e.os,e.Big,e._)}(this,(function(e,t,n,r,o,u,i,a){"use strict";function s(e){switch(void 0===e&&(e=process.env.NEAR_ENV),e){case"mainnet":return{networkId:"mainnet",nodeUrl:"https://rpc.mainnet.near.org",walletUrl:"https://wallet.near.org",WRAP_NEAR_CONTRACT_ID:"wrap.near",REF_FI_CONTRACT_ID:"v2.ref-finance.near"};case"testnet":return{networkId:"testnet",nodeUrl:"https://rpc.testnet.near.org",walletUrl:"https://wallet.testnet.near.org",WRAP_NEAR_CONTRACT_ID:"wrap.testnet",REF_FI_CONTRACT_ID:"ref-finance-101.testnet"};default:return{networkId:"mainnet",nodeUrl:"https://rpc.mainnet.near.org",walletUrl:"https://wallet.near.org",REF_FI_CONTRACT_ID:"v2.ref-finance.near",WRAP_NEAR_CONTRACT_ID:"wrap.near"}}}n=n&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n,o=o&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o,u=u&&Object.prototype.hasOwnProperty.call(u,"default")?u.default:u,i=i&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i,a=a&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a;var c=s(),l=c.REF_FI_CONTRACT_ID,p=function(e){return new Error(e)},f=p("Something wrong happened"),d=p("Input token should be different with output token"),v=p("Input amount should be greater than 0"),h=p("No pool found for the input tokens"),m=p("Please login in first"),k=p("Something wrong happened, we don't get correct routes corrreponding to current input"),w=p("This token doesn't exist in "+s().networkId),y=p("No public key found"),g=p("No local signer found"),b=p("Invalid access key"),I=p("Your input account id doesn't match the account id in the credential"),_=p("No Credential to such path"),x=function(e,t){return{id:Number("number"==typeof t?t:e.id),tokenIds:e.token_account_ids,supplies:e.amounts.reduce((function(t,n,r){return t[e.token_account_ids[r]]=n,t}),{}),fee:e.total_fee,shareSupply:e.shares_total_supply,tvl:e.tvl,token0_ref_price:e.token0_ref_price,pool_kind:e.pool_kind}},S=function(e){return{id:e.id,token1Id:e.tokenIds[0],token2Id:e.tokenIds[1],token1Supply:e.supplies[e.tokenIds[0]],token2Supply:e.supplies[e.tokenIds[1]],fee:e.fee,shares:e.shareSupply,token0_price:e.token0_ref_price||"0"}},N=function(e,t){return e.map((function(e){return e.token_account_ids})).flat().includes(t.toString())},O=function(e,t){return e.map((function(e){return e.id.toString()})).includes(t.toString())},T=function(e){return"RATED_SWAP"===e.pool_kind?24:18},P=function(e,t){return Number.isInteger(Number(t))?t:Math.ceil(Math.round(Number(t)*Math.pow(10,e))/Math.pow(10,e)).toString()},A=function(e){return r.divide(e,100)},E=function(e,t){return r.evaluate(A(e)+" * "+t)},R=function(e,t){return r.format(r.evaluate(t+" - "+E(e,t)),{notation:"fixed"})},j=function(e){return new n(e||"100000000000000")},L=/^0*\.?0*$/,C=function(e,t){return void 0===t&&(t="0"),e?((t.substring(0,t.length-e)||"0")+"."+t.substring(t.length-e).padStart(e,"0").substring(0,e)).replace(/\.?0+$/,""):t},F=function(e,t){if(null==e)return t;var n=t.split("."),r=n[1];return(""+n[0]+(void 0===r?"":r).padEnd(e,"0").slice(0,e)).replace(/^0+/,"").padStart(1,"0")},D=function(e){var t,n;if(!/e/.test(e)||!e)return e;var r=!0;/e-/.test(e)&&(r=!1);var o=Number(e)<0?"-":"",u=Number(null==(t=e.match(/\d+$/))?void 0:t[0]),i=null==(n=e.match(/[\d\.]+/))?void 0:n[0];if(!u||!i)return e;var a,s,c=i.includes(".");return c?(a=i.split(".")[0],s=i.split(".")[1]):(a=i,s=""),r?c?s.length<=u?o+a+s.padEnd(u,"0"):o+a+s.substring(0,u)+"."+s.substring(u):o+a.padEnd(u+a.length,"0"):c?o+a.padStart(u+a.length,"0").replace(/^0/,"0.")+s:o+a.padStart(u+a.length,"0").replace(/^0/,"0.")},M=function(e){for(var t=/(-?\d+)(\d{3})/;t.test(e);)e=e.replace(t,"$1,$2");return e},B=function(e,t,n,r){void 0===n&&(n=!1),void 0===r&&(r=!0);var o=e.split("."),u=o[0],i=o[1],a=void 0===i?"":i,s=((n?M(u):u)+"."+a.slice(0,t)).replace(/\.$/,"");if(r&&0===Number(s)&&s.length>1){var c=s.lastIndexOf("0");s=s.slice(0,c)+s.slice(c).replace("0","1")}return s},G=function(e,n){return e.map((function(e){return{signerId:n,receiverId:e.receiverId,actions:e.functionCalls.map((function(e){return{type:"FunctionCall",params:{methodName:e.methodName,args:e.args||{},gas:j(e.gas).toNumber().toFixed(),deposit:t.utils.format.parseNearAmount(e.amount||"0")}}}))}}))};function K(){K=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},o=r.iterator||"@@iterator",u=r.asyncIterator||"@@asyncIterator",i=r.toStringTag||"@@toStringTag";function a(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{a({},"")}catch(e){a=function(e,t,n){return e[t]=n}}function s(e,t,n,r){var o=Object.create((t&&t.prototype instanceof p?t:p).prototype),u=new _(r||[]);return o._invoke=function(e,t,n){var r="suspendedStart";return function(o,u){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===o)throw u;return{value:void 0,done:!0}}for(n.method=o,n.arg=u;;){var i=n.delegate;if(i){var a=g(i,n);if(a){if(a===l)continue;return a}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var s=c(e,t,n);if("normal"===s.type){if(r=n.done?"completed":"suspendedYield",s.arg===l)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(r="completed",n.method="throw",n.arg=s.arg)}}}(e,n,u),o}function c(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=s;var l={};function p(){}function f(){}function d(){}var v={};a(v,o,(function(){return this}));var h=Object.getPrototypeOf,m=h&&h(h(x([])));m&&m!==t&&n.call(m,o)&&(v=m);var k=d.prototype=p.prototype=Object.create(v);function w(e){["next","throw","return"].forEach((function(t){a(e,t,(function(e){return this._invoke(t,e)}))}))}function y(e,t){var r;this._invoke=function(o,u){function i(){return new t((function(r,i){!function r(o,u,i,a){var s=c(e[o],e,u);if("throw"!==s.type){var l=s.arg,p=l.value;return p&&"object"==typeof p&&n.call(p,"__await")?t.resolve(p.__await).then((function(e){r("next",e,i,a)}),(function(e){r("throw",e,i,a)})):t.resolve(p).then((function(e){l.value=e,i(l)}),(function(e){return r("throw",e,i,a)}))}a(s.arg)}(o,u,r,i)}))}return r=r?r.then(i,i):i()}}function g(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,g(e,t),"throw"===t.method))return l;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var r=c(n,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,l;var o=r.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,l):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,l)}function b(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function I(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function _(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(b,this),this.reset(!0)}function x(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,u=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return u.next=u}}return{next:S}}function S(){return{value:void 0,done:!0}}return f.prototype=d,a(k,"constructor",d),a(d,"constructor",f),f.displayName=a(d,i,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,a(e,i,"GeneratorFunction")),e.prototype=Object.create(k),e},e.awrap=function(e){return{__await:e}},w(y.prototype),a(y.prototype,u,(function(){return this})),e.AsyncIterator=y,e.async=function(t,n,r,o,u){void 0===u&&(u=Promise);var i=new y(s(t,n,r,o),u);return e.isGeneratorFunction(n)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},w(k),a(k,i,"Generator"),a(k,o,(function(){return this})),a(k,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=x,_.prototype={constructor:_,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(I),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return i.type="throw",i.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var o=this.tryEntries.length-1;o>=0;--o){var u=this.tryEntries[o],i=u.completion;if("root"===u.tryLoc)return r("end");if(u.tryLoc<=this.prev){var a=n.call(u,"catchLoc"),s=n.call(u,"finallyLoc");if(a&&s){if(this.prev<u.catchLoc)return r(u.catchLoc,!0);if(this.prev<u.finallyLoc)return r(u.finallyLoc)}else if(a){if(this.prev<u.catchLoc)return r(u.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<u.finallyLoc)return r(u.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var u=o;break}}u&&("break"===e||"continue"===e)&&u.tryLoc<=t&&t<=u.finallyLoc&&(u=null);var i=u?u.completion:{};return i.type=e,i.arg=t,u?(this.method="next",this.next=u.finallyLoc,l):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),l},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),I(n),l}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var o=r.arg;I(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:x(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),l}},e}function W(e,t,n,r,o,u,i){try{var a=e[u](i),s=a.value}catch(e){return void n(e)}a.done?t(s):Promise.resolve(s).then(r,o)}function q(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var u=e.apply(t,n);function i(e){W(u,r,o,i,a,"next",e)}function a(e){W(u,r,o,i,a,"throw",e)}i(void 0)}))}}function J(){return(J=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function U(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function $(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return U(e,void 0);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?U(e,void 0):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var V=function(){return"undefined"==typeof window?new t.keyStores.InMemoryKeyStore:new t.keyStores.BrowserLocalStorageKeyStore},Y=new t.providers.JsonRpcProvider({url:s().nodeUrl}),H=function(){var e=q(K().mark((function e(n){var r,i,a,c,l,p,f;return K().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.AccountId,i=n.keyPath,e.prev=1,a=u.homedir(),c=JSON.parse(o.readFileSync(a+i).toString()),l=null==c?void 0:c.account_id){e.next=7;break}throw _;case 7:if(l===r){e.next=9;break}throw I;case 9:return(p=new t.keyStores.InMemoryKeyStore).setKey(s().networkId,r,t.KeyPair.fromString(c.private_key)),f=new t.InMemorySigner(p),e.abrupt("return",f);case 15:throw e.prev=15,e.t0=e.catch(1),e.t0;case 18:case"end":return e.stop()}}),e,null,[[1,15]])})));return function(t){return e.apply(this,arguments)}}(),Z=function(e,t){if("FullAccess"===t.permission)return t;var n=t.permission.FunctionCall,r=n.method_names;return e.receiverId!==n.receiver_id?null:e.actions.every((function(e){if("FunctionCall"!==e.type)return!1;var t=e.params,n=t.deposit;return(!r.length||!r.includes(t.methodName))&&parseFloat(n)<=0}))},z=function(){var e=q(K().mark((function e(r){var o,u,i,a,c,l,p,f,d,v,h;return K().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=r.keyPath,i=G(r.transactionsRef,o=r.AccountId),e.next=4,Y.block({finality:"final"});case 4:return a=e.sent,c=[],e.next=8,H({AccountId:o,keyPath:u});case 8:l=e.sent,p=0;case 10:if(!(p<i.length)){e.next=31;break}return f=i[p],e.next=14,l.getPublicKey(o,s().networkId);case 14:if(d=e.sent){e.next=17;break}throw y;case 17:return e.next=19,Y.query({request_type:"view_access_key",finality:"final",account_id:o,public_key:d.toString()});case 19:if(Z(f,v=e.sent)){e.next=22;break}throw b;case 22:return h=t.transactions.createTransaction(o,t.utils.PublicKey.from(d.toString()),i[p].receiverId,v.nonce+p+1,f.actions.map((function(e){var r=e.params,o=r.deposit;return t.transactions.functionCall(r.methodName,r.args,new n(r.gas),new n(o))})),t.utils.serialize.base_decode(a.header.hash)),e.next=25,t.transactions.signTransaction(h,l,i[p].signerId,s().networkId);case 25:c.push(e.sent[1]);case 28:p+=1,e.next=10;break;case 31:return e.abrupt("return",c);case 32:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Q=function(){var e=q(K().mark((function e(t){var n,r,o;return K().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.signedTransactions,e.prev=1,r=[],o=0;case 4:if(!(o<n.length)){e.next=13;break}return e.t0=r,e.next=8,Y.sendTransaction(n[o]);case 8:e.t1=e.sent,e.t0.push.call(e.t0,e.t1);case 10:o+=1,e.next=4;break;case 13:return e.abrupt("return",r);case 16:throw e.prev=16,e.t2=e.catch(1),e.t2;case 19:case"end":return e.stop()}}),e,null,[[1,16]])})));return function(t){return e.apply(this,arguments)}}(),X=new t.Near(J({keyStore:V(),headers:{}},c)),ee=function(){var e=q(K().mark((function e(t){var n,r;return K().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.methodName,r=t.args,e.next=3,X.account(l);case 3:return e.abrupt("return",e.sent.viewFunction(l,n,r));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),te=function(){var e=q(K().mark((function e(t,n){var r,o;return K().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.methodName,o=n.args,e.next=3,X.account(l);case 3:return e.abrupt("return",e.sent.viewFunction(t,r,o));case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),ne=function(e,t){return te(e,{methodName:"storage_balance_of",args:{account_id:t}})},re=function(){var e=q(K().mark((function e(){return K().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",ee({methodName:"get_number_of_pools"}));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),oe=function(){var e=q(K().mark((function e(t){return K().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,te(t,{methodName:"ft_metadata"}).catch((function(){throw w}));case 2:return e.abrupt("return",J({},e.sent,{id:t}));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ue=function(){var e=q(K().mark((function e(t){return K().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(t.map((function(e){return oe(e)})));case 2:return e.abrupt("return",e.sent.reduce((function(e,n,r){var o;return J({},e,((o={})[t[r]]=n,o))}),{}));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ie=function(){var e=q(K().mark((function e(t){var n,r,o,u,i,a,s,p,f,d,v,h,m;return K().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.tokenIn,o=t.tokenOut,u=t.amountIn,i=t.slippageTolerance,s=t.AccountId,p=[],(null==(a=t.swapTodos)||null==(n=a.at(-1))?void 0:n.outputToken)===o.id){e.next=4;break}throw k;case 4:return f=function(){var e=q(K().mark((function e(t){return K().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ne(t.id,s).catch((function(){throw new Error(t.id+" doesn't exist.")}));case 2:null===e.sent&&p.push({receiverId:t.id,functionCalls:[{methodName:"storage_deposit",args:{registration_only:!0,account_id:s},gas:"30000000000000",amount:"0.1"}]});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e.next=7,f(o);case 7:for(h in d=[],v=a.map((function(e){return[e.inputToken,e.outputToken]})))d.push((m=v[h])[0]===r.id&&m[1]===o.id?{pool_id:a[h].pool.id,token_in:r.id,token_out:o.id,amount_in:a[h].pool.partialAmountIn,min_amount_out:P(o.decimals,F(o.decimals,R(i,a[h].estimate)))}:m[0]===r.id?{pool_id:a[h].pool.id,token_in:m[0],token_out:m[1],amount_in:a[h].pool.partialAmountIn,min_amount_out:"0"}:{pool_id:a[h].pool.id,token_in:m[0],token_out:m[1],min_amount_out:P(o.decimals,F(o.decimals,R(i,a[h].estimate)))});if(p.push({receiverId:r.id,functionCalls:[{methodName:"ft_transfer_call",args:{receiver_id:l,amount:F(r.decimals,u),msg:JSON.stringify({force:0,actions:d})},gas:"180000000000000",amount:"0.000000000000000000000001"}]}),r.id!==c.WRAP_NEAR_CONTRACT_ID){e.next=18;break}return e.next=14,ne(c.WRAP_NEAR_CONTRACT_ID,s);case 14:if(null!==e.sent){e.next=18;break}return e.next=18,f(r);case 18:return e.abrupt("return",p);case 19:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ae=function(){var e=q(K().mark((function e(t){var n;return K().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.id,e.abrupt("return",ee({methodName:"get_rated_pool",args:{pool_id:Number(n)}}).then((function(e){return J({},e,{id:Number(n),pool_kind:"RATED_SWAP"})})).catch((function(){throw f})));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),se=function(){var e=q(K().mark((function e(t){var n;return K().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.id,e.abrupt("return",ee({methodName:"get_stable_pool",args:{pool_id:Number(n)}}).then((function(e){return J({},e,{id:Number(n),pool_kind:"STABLE_SWAP",rates:e.c_amounts.map((function(e){return F(18,"1")}))})})).catch((function(){throw f})));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ce=function(){var e=q(K().mark((function e(t){return K().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.all(t.map((function(e){return"RATED_SWAP"===e.pool_kind?ae({id:e.id}):se({id:e.id})}))));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),le=function(){var e=q(K().mark((function e(t,n){var r;return K().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===t&&(t=1),void 0===n&&(n=100),r=(t-1)*n,e.next=5,ee({methodName:"get_pools",args:{from_index:r,limit:n}});case 5:return e.abrupt("return",e.sent.map((function(e,t){return x(e,t+r)})));case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),pe=function(){var e=q(K().mark((function e(){var t,n;return K().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,re();case 2:return t=Math.ceil(e.sent/100),e.next=6,Promise.all([].concat(Array(t)).fill(0).map((function(e,t){return le(t+1)})));case 6:return n=e.sent.flat(),e.abrupt("return",{simplePools:n.filter((function(e){return e.pool_kind&&"SIMPLE_POOL"===e.pool_kind})),unRatedPools:n.filter((function(e){return e.pool_kind&&"STABLE_SWAP"===e.pool_kind})),ratedPools:n.filter((function(e){return e.pool_kind&&"RATED_SWAP"===e.pool_kind}))});case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),fe=function(e,t){for(var n=t.length,r=a.sum(t),o=0,u=r,i=0;i<256;i++){for(var s,c=u,l=$(t);!(s=l()).done;)c=c*u/(s.value*n);o=u;var p=e*Math.pow(n,n);if(u=o*(c*n+p*r)/(o*(p-1)+c*(n+1)),Math.abs(u-o)<=1)break}return u},de=function(e,t,n,r,o){for(var u=n.length,i=e*Math.pow(u,u),a=fe(e,n),s=t,c=a*a/t,l=0;l<u;l++)l!=r&&l!=o&&(s+=n[l],c=c*a/n[l]);c=c*a/(i*Math.pow(u,u));for(var p=a/i+s,f=0,d=a,v=0;v<256&&(f=d,d=(Math.pow(d,2)+c)/(2*d+p-a),!(Math.abs(d-f)<=1));v++);return d},ve=function(e,t,n,r,o,u){var i=de(e,n+o[t],o,t,r),a=o[r]-i,s=function(e,t){return e*t/1e4}(a,u);return[a-s,s,a]},he=function(e,t,n,r,o){var u=r.amp,a=r.total_fee,s=r.token_account_ids.findIndex((function(t){return t===e})),c=r.token_account_ids.findIndex((function(e){return e===t})),l=r.rates.map((function(e){return C(o,e)})),p=r.c_amounts.map((function(e){return C(o,e)})).map((function(e,t){return F(o,D(new i(e||0).times(new i(l[t])).toString()))})).map((function(e){return Number(e)})),f=Number(F(o,D(new i(n).times(new i(l[s])).toString()))),d=ve(u,s,f,c,p,a),v=d[1],h=d[2];return[d[0]/Number(l[c]),v,h/Number(l[c])]};function me(e,t){t=new i(t);for(var n=(e=e.map((function(e){return new i(e).round()}))).map((function(e){return new i(e)})).reduce((function(e,t){return e.plus(t)}),new i(0)),r=t.minus(n),o=new i(0),u=0,a=0;a<e.length;a++)e[a].gt(o)&&(u=a,o=e[a]);for(var s=[],c=0;c<e.length;c++)s.push(c===u?e[c].plus(r).toString():e[c].toString());return s}i.RM=0,i.DP=40,i.NE=-40,i.PE=40;var ke=K().mark(Ve);function we(e){if(e<BigInt(0))throw"square root of negative numbers is not supported";return e<BigInt(2)?e:function e(t,n){var r=t/n+n>>BigInt(1);return n===r||n===r-BigInt(1)?n:e(t,r)}(e,BigInt(1))}function ye(e,t){if(e.length||(e=[e]),1==e.length)var n=new i(e[0].reserves[t[0]]);else if(2==e.length){var r=e[1];n=new i(e[0].reserves[t[0]]).times(new i(r.reserves[t[1]]))}return n}function ge(e,t){if(e.length||(e=[e]),1==e.length)var n=e[0],r=new i(1e4).minus(new i(n.fee)).div(new i(1e4)),o=i(r);else if(2==e.length){var u=e[0],a=e[1],s=new i(1e4).minus(new i(u.fee)).div(new i(1e4)),c=new i(1e4).minus(new i(a.fee)).div(i(1e4));o=new i(a.reserves[t[1]]).times(new i(s)).plus(new i(u.reserves[t[1]]).times(s).times(c))}return o}function be(e,t){if(e.length||(e=[e]),1==e.length){var n,r=e[0],o=t[0],u=t[1],a=new i(1e4).minus(new i(r.fee)).div(new i(1e4)),s=r.token2Id,c=r.token2Supply;r.reserves=((n={})[r.token1Id]=r.token1Supply,n[s]=c,n);var l=new i(r.reserves[o]).times(new i(r.reserves[u]).times(new i(a)))}else if(2==e.length){var p,f,d=e[0],v=e[1],h=d.token2Id,m=d.token2Supply;d.reserves=((p={})[d.token1Id]=d.token1Supply,p[h]=m,p);var k=v.token2Id,w=v.token2Supply;v.reserves=((f={})[v.token1Id]=v.token1Supply,f[k]=w,f);var y=t[0],g=t[1],b=t[2],I=new i(1e4).minus(i(d.fee)).div(new i(1e4)),_=new i(1e4).minus(new i(v.fee)).div(new i(1e4)),x=new i(d.reserves[y]).times(new i(d.reserves[g])).times(I),S=new i(v.reserves[g]).times(new i(v.reserves[b])).times(_);l=x.times(S)}return l}function Ie(e,t,n){var r=be(t,n),o=ye(t,n),u=ge(t,n);return new i(e).abs().times(new i(we(BigInt(new i(r).round().toFixed())))).minus(o).div(u)}function _e(e,t){var n=[];for(var r in t){var o=t[r].map((function(e){return e.length})).reduce((function(e,t){return e*t}),1);n.push(o)}var u=[];for(var i in e)for(var a=e[i],s=n[i],c=0;c<s;c++)u.push(a);return u}function xe(e,t,n){void 0===n&&(n=.001);var r=[];for(var o in e){for(var u=e[o],i=[],a=[],s=0;s<u.length-1;s++)a.push([u[s],u[s+1]]);for(var c in a){var l=a[c],p=Me(t,l[0],l[1]);i.push(p)}r.push(i)}return function(e,t){void 0===t&&(t=.001);var n=[];for(var r in e){var o=e[r],u=[];for(var i in o){var a=Be(o[i],t);u.push(a)}n.push(u)}return n}(r,n)}function Se(e){var t=[];for(var n in e){var r=e[n].reduce((function(e,t){return e.flatMap((function(e){return t.map((function(t){return[e,t].flat()}))}))}));t.push.apply(t,r)}for(var o in t)t[o].length||(t[o]=[t[o]]);return t}function Ne(e,t,n,r){if(r=new i(r),t===e.token1Id&&n===e.token2Id)var o,u=((o={})[t]=new i(e.token1Supply),o[n]=new i(e.token2Supply),o);else{if(t!==e.token2Id||n!==e.token1Id)return new i(0);var a;(a={})[n]=new i(e.token1Supply),a[t]=new i(e.token2Supply),u=a}var s=new i(1e4).minus(new i(e.fee)).div(new i(1e4)),c=r.times(s).times(u[n]),l=u[t].plus(s.times(r));return c.div(l)}function Oe(e,t,n){if(new i(n).eq(new i(0)))return new i(0);if(n=new i(n),e.length||(e=[e]),1==e.length)var r=Ne(e[0],t[0],t[1],n);else 2==e.length&&(r=function(e,t,n,r,o){for(var u in o=new i(o),e){var a=e[u];a.gamma=new i(1e4).minus(new i(a.fee)).div(new i(1e4))}var s,c,l=e[0],p=e[1];if(t===l.token1Id&&n===l.token2Id)l.reserves=((s={})[t]=new i(l.token1Supply),s[n]=new i(l.token2Supply),s);else if(n===l.token1Id&&t===l.token2Id){var f;l.reserves=((f={})[n]=new i(l.token1Supply),f[t]=new i(l.token2Supply),f)}if(n===p.token1Id&&r===p.token2Id)p.reserves=((c={})[n]=new i(p.token1Supply),c[r]=new i(p.token2Supply),c);else if(r===p.token1Id&&n===p.token2Id){var d;p.reserves=((d={})[r]=new i(p.token1Supply),d[n]=new i(p.token2Supply),d)}var v=new i(l.reserves[n]),h=new i(l.reserves[t]),m=new i(p.reserves[n]),k=new i(p.reserves[r]),w=l.gamma,y=p.gamma,g=o.times(v).times(k).times(w).times(y),b=m.times(h).plus(o.times(m.times(w).plus(v.times(w).times(y))));return g.div(b)}(e,t[0],t[1],t[2],n));return r}function Te(e,t,n){var r=function e(t,n,r){var o=function(e,t,n){var r=[];for(var o in t)r.push(Ie(e,t[o],n[o]));return r}(function(e,t,n){var r=function(e,t){var n=new i(0);for(var r in e){var o=e[r],u=t[r],a=be(o,u),s=new i(we(BigInt(new i(a).round().toFixed()))),c=ge(o,u),l=new i(c);n=n.plus(s.div(l))}return n}(e,t),o=function(e,t){var n=new i(0);for(var r in e){var o=e[r],u=t[r],a=new i(ye(o,u)),s=new i(ge(o,u));n=n.plus(a.div(s))}return n}(e,t);return new i(n).plus(o).div(r)}(t,n,r=new i(r)),t,n);o.every((function(e){return e.lt(new i(0))}))&&(o=o.map((function(e){return e.times(new i(-1))}))),o.some((function(e){return e.lt(new i(0))}))&&(o=function(t,n,r,o){o=new i(o);var u=[];for(var a in r)r[a].gt(new i(0))&&u.push(a);var s=[],c=[];for(var a in u){var l=u[a];s.push(t[l]),c.push(n[l])}r=e(s,c,o);var p={};for(var a in u)p[u[a]]=r[a];var f=[];for(var a in t)if(u.includes(a))f.push(p[a]);else{var d=new i(0);f.push(d)}return f}(t,n,o,r));var u=o.reduce((function(e,t){return e.plus(t)}),new i(0));return o.map((function(e){return e.div(u).times(new i(r))}))}(e,t,n),o=[];for(var u in e){var a=Oe(e[u],t[u],r[u]);o.push(a)}return{result:o,allocations:r}}function Pe(e,t,n){var r=Te(e,t,n),o=r.result,u=r.allocations;return u=me(u,n),new i(0),new i(0),{input:u,output:o.map((function(e){return new i(e)})).reduce((function(e,t){return e.plus(t)}),new i(0))}}function Ae(e,t,n,r,o,u){return Ee.apply(this,arguments)}function Ee(){return(Ee=q(K().mark((function e(t,n,r,o,u,a){return K().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===u&&(u=3),void 0===a&&(a=.001),e.abrupt("return",function(){var e=q(K().mark((function e(o){var s,c,l,p,f;return K().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=new i(o),e.next=3,He(t,n,r,u);case 3:if((s=e.sent).length){e.next=6;break}return e.abrupt("return",{allocations:[],outputs:new i(0),routes:[],nodeRoutes:[]});case 6:return e.next=8,xe(s,t,a);case 8:return c=e.sent,e.next=11,Se(c);case 11:return l=e.sent,e.next=14,_e(s,c);case 14:return p=e.sent,e.next=17,Pe(l,p,o);case 17:return e.abrupt("return",{allocations:(f=e.sent).input,outputs:f.output,routes:l,nodeRoutes:p});case 21:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()(o));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Re(e,t,n){return function(e,t,n){var r=n.map((function(e){return new i(e)})).reduce((function(e,t){return e.plus(t)}),new i(0)).toString(),o=[];for(var u in e){var a=e[u],s=t[u],c=n[u];if(!new i(c).eq(new i(0))&&(a.length||(a=[a]),a[0]))for(var l in a){var p=a[l];if(0==l){var f={pool:p,allocation:c.toString(),inputToken:s[0],outputToken:s[1],nodeRoute:s,route:a,allRoutes:e,allNodeRoutes:t,totalInputAmount:r,allAllocations:n};if(o.push(f),s.length>2)var d=Ne(p,s[0],s[1],c)}else f={pool:p,allocation:d.toString(),inputToken:s[1],outputToken:s[2],nodeRoute:s,route:a,allRoutes:e,allNodeRoutes:t,totalInputAmount:r,allAllocations:n},o.push(f)}}return o}(e,t,n)}function je(e,t,n,r,o,u,i,a,s){return Le.apply(this,arguments)}function Le(){return(Le=q(K().mark((function e(t,n,r,o,u,a,s,c,l){return K().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===u&&(u=3),void 0===a&&(a=.001),void 0===s&&(s=2),void 0===c&&(c=4),void 0===l&&(l=[]),e.abrupt("return",function(){var e=q(K().mark((function e(o){var p,f,d,v,h,m,k,w,y,g,b,I,_,x,S,N,O,T,P,A,E,R,j,L,C,F,D,M,B,G,W,J,U,V,Y,H,Z,z,Q,X,ee,te,ne,re,ue,ie,ae,se,ce,le,pe,fe,de,ve,he,ke,we,ye,ge,be,Ie,_e,xe,Se,Oe,Pe,Ee,Le,Fe,Me,Be,Ge,Ke,We,qe;return K().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o){e.next=2;break}return e.abrupt("return",[]);case 2:return o=new i(o),t=t.filter((function(e){return!l.includes(e.id)})),e.next=6,Ae(t,n,r,o,u,a);case 6:for(d=(p=e.sent).routes,v=p.nodeRoutes,h=De(f=p.allocations),m=h.slice(0,10),k=[],w=[],y=$(m);!(g=y()).done;)k.push(d[b=g.value]),w.push(v[b]);for(T in d=k,v=w,I=new i(0),_=p.allocations,x=p.nodeRoutes,N=[],O=[],S=p.routes)2==(P=x[T]).length&&(N.push(P),O.push(S[T]));if(A=!1,N.length>0){if(E=Te(O,N,o),j=E.result,(R=E.allocations).length>c){for(D in L=(L=De(R)).slice(0,c),C=[],F=[],L)C.push(O[L[D]]),F.push(N[L[D]]);E=Te(C,F,o),R=E.allocations,j=E.result}M=j.reduce((function(e,t){return e.plus(t)}),new i(0)),new i(M).gt(I)&&(_=R,I=M,S=O,x=N,A=!0)}B=!1,e.t0=K().keys(d);case 29:if((e.t1=e.t0()).done){e.next=59;break}D=e.t1.value,e.t2=K().keys(d);case 32:if((e.t3=e.t2()).done){e.next=57;break}if(!((G=e.t3.value)>D)){e.next=55;break}for(W=d[D],J=d[G],U=v[D],V=v[G],Y=new Set(W.map((function(e){return e.id}))),H=new Set(J.map((function(e){return e.id}))),Z=!1,z=$(Y);!(Q=z()).done;)H.has(Q.value)&&(Z=!0);if(!Z){e.next=47;break}return e.abrupt("continue",32);case 47:B=!0,te=Te(X=[W,J],ee=[U,V],o),ne=te.allocations,re=te.result.reduce((function(e,t){return e.plus(t)}),new i(0)),new i(re).gt(I)&&(_=ne,I=re,S=X,x=ee,A=!1);case 55:e.next=32;break;case 57:e.next=29;break;case 59:if(!B)for(D in d)ae=Te(ue=[d[D]],ie=[v[D]],o),se=ae.allocations,ce=ae.result.reduce((function(e,t){return e.plus(t)}),new i(0)),new i(ce).gt(I)&&(_=se,I=ce,S=ue,x=ie,A=!1);if(f=_,v=x,!((d=S).length<1)){e.next=65;break}return e.abrupt("return",[]);case 65:for(D in le=De(f.map((function(e){return new i(e)}))),A&&(s=4),pe=le.slice(0,s),fe=[],de=[],pe)fe.push(d[ve=pe[D]]),de.push(v[ve]);for(D in fe)fe[D].length||(fe[D]=[fe[D]]);if(he=fe[0].map((function(e){return e.id})),!(fe.length>1)){e.next=84;break}ke=fe[1].map((function(e){return e.id})),we=!1,e.t4=K().keys(ke);case 77:if((e.t5=e.t4()).done){e.next=84;break}if(!he.includes(ke[D=e.t5.value])){e.next=82;break}return we=!0,e.abrupt("break",84);case 82:e.next=77;break;case 84:if(!we){e.next=109;break}for(D in ye=[],ge=[],le)ye.push(d[le[D]]),ge.push(v[le[D]]);for(D in be=ye[0].map((function(e){return e.id})),ye)ye[D].length||(ye[D]=[ye[D]]);Ie=ye.map((function(e){return e.map((function(e){return e.id}))})),e.t6=K().keys(Ie);case 93:if((e.t7=e.t6()).done){e.next=109;break}D=e.t7.value,e.t8=K().keys(Ie[D]);case 96:if((e.t9=e.t8()).done){e.next=107;break}if(!be.includes(Ie[D][G=e.t9.value])){e.next=100;break}return e.abrupt("break",107);case 100:return(_e=ye[D]).length||(_e=[_e]),fe=[ye[0],_e],de=[ge[0],ge[D]],e.abrupt("break",107);case 107:e.next=93;break;case 109:xe=Te(fe,de,o),Se=me(Se=xe.allocations,o).map((function(e){return new i(e)})),Oe=Re(fe,de,Se),Pe=[],e.t10=K().keys(Oe);case 116:if((e.t11=e.t10()).done){e.next=139;break}return D=e.t11.value,e.next=120,oe(Oe[D].inputToken);case 120:return Le=e.sent,e.next=123,oe(Oe[D].outputToken);case 123:if(Fe=e.sent.decimals,Me=Ne(Oe[D].pool,Oe[D].inputToken,Oe[D].outputToken,Oe[D].allocation),Be=new i(Me).div(new i(10).pow(Fe)).toString(),!new i(Me).lt(new i(1))){e.next=130;break}return l.push(Oe[D].pool.id),e.abrupt("return",je(t,n,r,o,u=u,a=a,s=s,c=c,l=l));case 130:return Ge=Oe[D].inputToken==n&&Oe[D].outputToken==r?"parallel swap":"stableSmart",e.next=133,Promise.all(Oe[D].nodeRoute.map(function(){var e=q(K().mark((function e(t){return K().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,oe(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 133:Ke=e.sent,Pe[D]={estimate:Be,pool:{fee:Oe[D].pool.fee,gamma_bps:new i(1e4).minus(new i(Oe[D].pool.fee)),id:Oe[D].pool.id,partialAmountIn:new i(Oe[D].allocation).round().toString(),supplies:(Ee={},Ee[Oe[D].pool.token1Id]=Oe[D].pool.token1Supply,Ee[Oe[D].pool.token2Id]=Oe[D].pool.token2Supply,Ee),token0_ref_price:Oe[D].pool.token0_price,tokenIds:[Oe[D].pool.token1Id,Oe[D].pool.token2Id],Dex:Oe[D].pool.Dex},status:Ge,token:Le,outputToken:Oe[D].outputToken,inputToken:Oe[D].inputToken,nodeRoute:Oe[D].nodeRoute,route:Oe[D].route,allRoutes:Oe[D].allRoutes,allNodeRoutes:Oe[D].allNodeRoutes,totalInputAmount:Oe[D].totalInputAmount,allAllocations:Oe[D].allAllocations,tokens:Ke,routeInputToken:n,routeOutputToken:r,overallPriceImpact:"0"},Pe[D].pool.x=Pe[D].pool.supplies[Oe[D].inputToken],Pe[D].pool.y=Pe[D].pool.supplies[Oe[D].outputToken],e.next=116;break;case 139:return e.next=141,Ce(Pe);case 141:for(D in We=e.sent,Pe)(qe=Pe[D]).overallPriceImpact=We,qe.outputToken===r&&qe.inputToken!=n&&(qe.pool.partialAmountIn="0");return e.abrupt("return",Pe);case 144:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()(o));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ce(e){return Fe.apply(this,arguments)}function Fe(){return(Fe=q(K().mark((function e(t){var n,r,o,u,a,s,c,l,p,f,d,v,h,m,k,w,y,g,b,I,_,x,S;return K().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.filter((function(e){return e.outputToken==e.routeOutputToken})).map((function(e){return new i(e.estimate)})).reduce((function(e,t){return e.plus(t)}),new i(0)),r=t[0].tokens[0],o=new i(t[0].totalInputAmount).div(new i(10).pow(r.decimals)),u=n.div(o),a=new i(0),s=t[0].allRoutes,c=t[0].allNodeRoutes,l=t[0].allAllocations.map((function(e){return new i(e)})),p=l.map((function(e){return new i(e)})).reduce((function(e,t){return e.plus(t)}),new i(0)),f=l.map((function(e){return e.div(p)})),e.t0=K().keys(s);case 11:if((e.t1=e.t0()).done){e.next=23;break}return v=s[d=e.t1.value],h=c[d],e.next=17,Promise.all(h.map(function(){var e=q(K().mark((function e(t){return K().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,oe(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 17:m=e.sent,k=f[d],1==v.length?(w=new i(v[0].reserves[h[0]]).div(new i(10).pow(m[0].decimals)),y=new i(v[0].reserves[h[1]]).div(new i(10).pow(m[1].decimals)),g=w.div(y)):(b=new i(v[0].reserves[h[0]]).div(new i(10).pow(m[0].decimals)),I=new i(v[0].reserves[h[1]]).div(new i(10).pow(m[1].decimals)),_=new i(v[1].reserves[h[1]]).div(new i(10).pow(m[1].decimals)),x=new i(v[1].reserves[h[2]]).div(new i(10).pow(m[2].decimals)),g=b.div(I).times(_).div(x)),a=a.plus(k.times(new i(1).div(g))),e.next=11;break;case 23:return S=a.minus(u).div(u).times(new i(100)).toString(),e.abrupt("return",S);case 25:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function De(e){return function(e){var t=[];for(var n in e)t.push([e[n],n]);return t}(e).sort((function(e,t){return new i(t[0]).minus(new i(e[0]))})).map((function(e){return e[1]}))}function Me(e,t,n,r){void 0===r&&(r=!0);var o=e.filter((function(e){return e.token1Id===t&&e.token2Id===n||e.token1Id===n&&e.token2Id===t}));return r&&(o=o.filter((function(e){return"0"!=e.token1Supply&&"0"!=e.token2Supply}))),o}function Be(e,t){void 0===t&&(t=1e-4);for(var n=new i(t),r=function(e){var t=function(e){var t=[];for(var n in e){var r=e[n];r.amounts=[r.token1Supply,r.token2Supply];var o=r.amounts.map((function(e){return new i(e)})),u=o[0].times(o[1]);t.push(u)}return t}(e),n=function(e){if(e.length<1)return null;var t=e[0];for(var n in e){var r=e[n];r.gt(t)&&(t=r)}return t}(t);return t.map((function(e){return e.div(n)}))}(e),o=[],u=0;u<r.length;u++)r[u]>n&&o.push(e[u]);return o}function Ge(e,t){var n=t[0],r=t[1];Object.keys(e).includes(n)?Object.keys(e[n]).includes(r)||(e[n][r]=1):(e[n]={},e[n][r]=1),Object.keys(e).includes(r)?Object.keys(e[r]).includes(n)||(e[r][n]=1):(e[r]={},e[r][n]=1)}function Ke(e,t){var n=JSON.parse(JSON.stringify(e)),r=t[0],o=t[1];return Object.keys(n).includes(r)&&Object.keys(n[r]).includes(o)&&delete n[r][o],Object.keys(n).includes(o)&&Object.keys(n[o]).includes(r)&&delete n[o][r],n}function We(e,t){var n=JSON.parse(JSON.stringify(e));Object.keys(n).includes(t)&&delete n[t];var r=Object.keys(n);for(var o in r){var u=r[o];Object.keys(n[u]).includes(t)&&delete n[u][t]}return n}function qe(e,t,n,r,o){void 0===r&&(r=[]),void 0===o&&(o=[]);var u=JSON.parse(JSON.stringify(e));for(var i in r)u=We(u,r[i]);for(var a in o)u=Ke(u,o[a]);var s=function(e,t){var n={};for(n[t]={},n[t].path=[],n[t].dist=0;;){var r=null,o=null,u=Infinity;for(var i in n)if(n[i]||(n[i]={}),n[i].path){var a=n[i].dist,s=e[i];for(var c in s)if(n[c]||(n[c]={}),!n[c].path){var l=s[c]+a;l<u&&(r=n[i].path,o=c,u=l)}}if(Infinity===u)break;n[o].path=r.concat(o),n[o].dist=u}return n}(u,t)[n];return s.path.unshift(t),s}i.RM=0,i.DP=40,i.NE=-40,i.PE=40;var Je=function(){function e(){this.paths=[],this.sortedpaths=[]}var t=e.prototype;return t.len=function(){return this.sortedpaths.length},t.push=function(e,t){t&&!$e(this.paths,t)&&(this.sortedpaths.push([e,t]),this.sortedpaths.sort((function(e,t){return e[0]-t[0]})),this.paths.push(t))},t.pop=function(){var e=this.sortedpaths.shift()[1];return this.paths.splice(this.paths.indexOf(e),1),e},e}();function Ue(e,t){return Array.isArray(e)&&Array.isArray(t)&&e.length===t.length&&e.every((function(e,n){return e===t[n]}))}function $e(e,t){var n=JSON.stringify(t);for(var r in e)if(JSON.stringify(e[r])==n)return!0;return!1}function Ve(e,t,n){var r,o,u,i,a,s,c,l,p,f,d,v,h,m,k,w;return K().wrap((function(y){for(;;)switch(y.prev=y.next){case 0:r=[],o=new Je,u=null;case 3:if(u)for(a=[],s=[],c=1;c<u.length;c++){for(f in l=u.slice(0,c),p=l.length,r)Ue((d=r[f]).slice(0,c),l)&&s.push([d[c-1],d[c]]);try{v=qe(e,l[l.length-1],n,a=a,s=s),h=v.dist,m=v.path,k=l.slice(0,l.length-1).concat(m),o.push(p+h,k)}catch(e){}a.push(l[l.length-1])}else i=qe(e,t,n),o.push(i.dist,i.path);if(!o.sortedpaths){y.next=19;break}return y.prev=6,w=o.pop(),y.next=10,w;case 10:r.push(w),u=w,y.next=17;break;case 14:return y.prev=14,y.t0=y.catch(6),y.abrupt("break",22);case 17:y.next=20;break;case 19:return y.abrupt("break",22);case 20:y.next=3;break;case 22:case"end":return y.stop()}}),ke,null,[[6,14]])}function Ye(e,t,n,r,o){return void 0===o&&(o=3),function(o){var u=[];o<2&&(o=2);for(var i=Ve(e,t,n),a=1;a<=r;a++)try{var s=i.next().value;if(s&&!$e(u,s)){if(s.length>o)break;u.push(s)}}catch(e){break}return u}(o)}function He(e,t,n,r){return Ze.apply(this,arguments)}function Ze(){return(Ze=q(K().mark((function e(t,n,r,o){var u;return K().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===o&&(o=3),u=ze(t),e.abrupt("return",Ye(u,n,r,100,o));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ze(e){var t={};return function(e,t){for(var n in t)Ge(e,t[n])}(t,e.filter((function(e){return"0"!=e.token1Supply&&"0"!=e.token2Supply})).map((function(e){return[e.token1Id,e.token2Id]}))),t}function Qe(e,t,n,r,o){return Xe.apply(this,arguments)}function Xe(){return(Xe=q(K().mark((function e(t,n,r,o,u){return K().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,je(t,n,r,o,u);case 2:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function et(e,t){return e.filter((function(e){return e.outputToken===t})).map((function(e){return new i(e.estimate)})).reduce((function(e,t){return e.plus(t)}),new i(0))}var tt=function(e){var t=e.tokenIn,n=e.tokenOut,r=e.pool,o=Number(e.amountIn)*(1e4-r.fee),u=C(t.decimals,r.supplies[t.id]),a=C(n.decimals,r.supplies[n.id]);return{estimate:new i((o*Number(a)/(1e4*Number(u)+o)).toString()).toFixed(),pool:r,outputToken:n.id,inputToken:t.id}},nt=function(e){var t=e.tokenIn,n=e.tokenOut,r=e.amountIn,o=e.stablePool,u=T(o),i=he(t.id,n.id,r,o,u),a=i[0],s=i[2],c=a<0||isNaN(a)?"0":B(D(a.toString()),0),l=a<0||isNaN(a)||isNaN(s)?"0":B(D(s.toString()),0);return{estimate:C(u,c),noFeeAmountOut:C(u,l),pool:o,outputToken:n.id,inputToken:t.id}},rt=function(e){var t=e.tokenIn,n=e.tokenOut,r=e.simplePools,o=e.amountIn,u=e.stablePools;if(!r||0===r.length)throw h;var i=r.filter((function(e){return e.tokenIds.includes(t.id)&&e.tokenIds.includes(n.id)})).map((function(e){return tt({tokenIn:t,tokenOut:n,pool:e,amountIn:o})})),s=null==u?void 0:u.filter((function(e){return e.token_account_ids.includes(t.id)&&e.token_account_ids.includes(n.id)})),c=null==s?void 0:s.map((function(e){return nt({tokenIn:t,tokenOut:n,amountIn:o,stablePool:e})})),l=void 0===i||0===i.length?void 0:1===i.length?i[0]:a.maxBy(i,(function(e){return Number(e.estimate)})),p=void 0===c||0===c.length?void 0:1===c.length?c[0]:a.maxBy(c,(function(e){return Number(e.estimate)}));if(!p&&!l)throw h;return p?l&&Number(null==l?void 0:l.estimate)>Number(null==p?void 0:p.estimate)?l:p:l},ot=function(e){var t=e.tokenInId,n=e.tokenOutId;return e.stablePools.filter((function(e){return e.tokenIds.includes(t)&&e.tokenIds.includes(n)&&t!==n}))},ut=function(e){var t=e.tokenInId,n=e.tokenOutId;return t===n?[]:e.pools.filter((function(e){return e.tokenIds.includes(t)&&e.tokenIds.includes(n)}))},it=function(){var e=q(K().mark((function e(t){var n,r,o,u,i;return K().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.tokenIn,r=t.tokenOut,o=t.amountIn,i=t.pool,!(u=t.stablePoolDetail)){e.next=5;break}return e.abrupt("return",nt({tokenIn:n,tokenOut:r,stablePool:u,amountIn:o}));case 5:return e.abrupt("return",tt({tokenIn:n,tokenOut:r,pool:i,amountIn:o}));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();function at(e,t,n,r,o,u){return st.apply(this,arguments)}function st(){return(st=q(K().mark((function e(t,n,r,o,u,s){var c,l,p,f,d,v,h,m,k,w,y,g,b,I,_,x,S,T,P,A,E,R,j,L,D,M,B,G,W,q,U,V,Y,H,Z,z,Q,X,ee,te,ne,re,ie,ae,se;return K().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(N(u,t.id)||N(u,n.id)){e.next=2;break}return e.abrupt("return",{actions:[],estimate:"0"});case 2:if(c=u.reduce((function(e,t){var n;return J({},e,((n={})[t.id]=t,n))}),{}),l=F(t.decimals,r),d=[],v=[],h=[],m=[],k=[],N(u,t.id))for(d=o.filter((function(e){return e.tokenIds.includes(t.id)})),w=d.map((function(e){return e.tokenIds.filter((function(e){return e!==t.id}))})).flat(),y=$(w);!(g=y()).done;)I=ot({tokenInId:b=g.value,tokenOutId:n.id,stablePools:o}),_=ut({tokenInId:b,tokenOutId:n.id,pools:s}),x=_.concat(I),v.push.apply(v,x.filter((function(e){var t=Object.values(e.supplies);return new i(t[0]).times(new i(t[1])).gt(0)})));if(N(u,n.id))for(m=o.filter((function(e){return e.tokenIds.includes(n.id)})),S=m.map((function(e){return e.tokenIds.filter((function(e){return e!==n.id}))})).flat(),T=$(S);!(P=T()).done;)E=ot({tokenInId:t.id,tokenOutId:A=P.value,stablePools:o}),R=ut({tokenInId:t.id,tokenOutId:A,pools:s}),j=R.concat(E),h.push.apply(h,j.filter((function(e){var t=Object.values(e.supplies);return new i(t[0]).times(new i(t[1])).gt(0)})));for(L=$(d);!(D=L()).done;)for(B=(M=D.value).tokenIds.filter((function(e){return e!==t.id})),G=function(){var e=q.value,t=v.filter((function(t){return t.tokenIds.includes(e)&&t.tokenIds.includes(n.id)&&e!==n.id})),r=a.maxBy(t,(function(e){return Number(new i(C(n.decimals,e.supplies[n.id])))}));e===n.id&&(r=M),M&&r&&k.push(M.id===r.id?[M]:[M,r])},W=$(B);!(q=W()).done;)G();for(U=0,V=h;U<V.length;U++)for(H=(Y=V[U]).tokenIds.filter((function(e){return e!==t.id})),Z=function(){var e=Q.value,t=m.filter((function(t){return t.tokenIds.includes(e)&&t.tokenIds.includes(n.id)&&e!==n.id})),r=a.maxBy(t,(function(e){return Number(new i(C(n.decimals,e.supplies[n.id])))}));e===n.id&&(r=Y),Y&&r&&k.push(Y.id===r.id?[Y]:[Y,r])},z=$(H);!(Q=z()).done;)Z();if(!(k.length>0)){e.next=36;break}return e.next=16,ue(k.map((function(e){return e.map((function(e){return e.tokenIds})).flat()})).flat());case 16:if(X=e.sent,ee=1===k.length?k[0]:a.maxBy(k,(function(e){if(1===e.length){if(O(u,e[0].id)){var i=ot({tokenInId:t.id,tokenOutId:n.id,stablePools:o})[0],a=u.find((function(e){return e.id===i.id}));return Number(nt({tokenIn:t,tokenOut:n,stablePool:a,amountIn:r}).estimate)}return Number(tt({tokenIn:t,tokenOut:n,amountIn:r,pool:e[0]}).estimate)}var s=e[0],l=e[1],p=e[0].tokenIds.find((function(t){return e[1].tokenIds.includes(t)})),f=X[p],d=J({},O(u,s.id)?nt({tokenIn:t,tokenOut:f,amountIn:r,stablePool:c[s.id]}):tt({tokenIn:t,tokenOut:f,amountIn:r,pool:s})),v=J({},O(u,l.id)?nt({tokenIn:f,tokenOut:n,amountIn:d.estimate,stablePool:c[l.id]}):tt({tokenIn:f,tokenOut:n,pool:l,amountIn:d.estimate}));return Number(v.estimate)}))){e.next=20;break}return e.abrupt("return",{actions:[],estimate:"0"});case 20:if(1!==ee.length){e.next=26;break}return te=ee[0],e.next=24,it({tokenIn:t,tokenOut:n,amountIn:r,pool:te,stablePoolDetail:c[te.id]});case 24:return e.abrupt("return",{actions:[J({},ne=e.sent,{pool:J({},te,{parsedAmountIn:l}),tokens:[t,n],inputToken:t.id,outputToken:n.id,totalInputAmount:F(t.decimals,r)})],estimate:ne.estimate});case 26:return p=ee[0],f=ee[1],re=ee[0].tokenIds.find((function(e){return ee[1].tokenIds.includes(e)})),e.next=31,oe(re);case 31:return ie=e.sent,(ae=J({},O(u,p.id)?nt({tokenIn:t,tokenOut:ie,amountIn:r,stablePool:c[p.id]}):tt({tokenIn:t,tokenOut:ie,amountIn:r,pool:p}),{tokens:[t,ie,n],inputToken:t.id,outputToken:ie.id})).pool.partialAmountIn=l,se=J({},O(u,f.id)?nt({tokenIn:ie,tokenOut:n,amountIn:ae.estimate,stablePool:c[f.id]}):tt({tokenIn:ie,tokenOut:n,amountIn:ae.estimate,pool:f}),{tokens:[t,ie,n],inputToken:ie.id,outputToken:n.id}),e.abrupt("return",{actions:[ae,se],estimate:se.estimate});case 36:return e.abrupt("return",{actions:[],estimate:"0"});case 37:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ct=function(){var e=q(K().mark((function e(t){var n,r,o,u,a,s,c,l,p,f,m,k,w,y,g,b;return K().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=t.amountIn,u=t.simplePools,a=t.options,(n=t.tokenIn).id!==(r=t.tokenOut).id){e.next=3;break}throw d;case 3:if(!L.test(o)){e.next=5;break}throw v;case 5:if(c=(s=a||{}).enableSmartRouting,l=s.stablePools,p=s.stablePoolsDetail,f=F(n.decimals,o),c){e.next=13;break}return m=rt({tokenIn:n,tokenOut:r,simplePools:u,amountIn:o,stablePools:p}),console.log(m,"estimate"),e.abrupt("return",[J({},m,{pool:J({},null==m?void 0:m.pool,{partialAmountIn:f})})]);case 13:return k=u.map((function(e){return S(e)})),e.next=16,Qe(k,n.id,r.id,f);case 16:return y=et(w=e.sent,r.id).toString(),e.next=20,at(n,r,o,l||[],p||[],u);case 20:if(b=(g=e.sent).estimate.toString(),!new i(y||"0").gte(b||"0")){e.next=28;break}if(null!=w&&w.length){e.next=25;break}throw h;case 25:return e.abrupt("return",w);case 28:return e.abrupt("return",g.actions);case 29:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();e.AccountIdMisMatch=I,e.DEFAULT_PAGE_LIMIT=100,e.FEE_DIVISOR=1e4,e.InValidAccessKeyError=b,e.NoCredential=_,e.NoLocalSignerError=g,e.NoPoolError=h,e.NoPuiblicKeyError=y,e.NotLoginError=m,e.ONE_YOCTO_NEAR="0.000000000000000000000001",e.ONLY_ZEROS=L,e.RATED_POOL_LP_TOKEN_DECIMALS=24,e.REF_FI_CONTRACT_ID=l,e.STABLE_LP_TOKEN_DECIMALS=18,e.STORAGE_TO_REGISTER_WITH_MFT="0.1",e.SameInputTokenError=d,e.SwapRouteError=k,e.TokenNotExistError=w,e.ZeroInputError=v,e.calc_d=fe,e.calc_swap=ve,e.calc_y=de,e.config=c,e.convertToPercentDecimal=A,e.estimateSwap=ct,e.fetchAllPools=pe,e.formatError=p,e.formatWithCommas=M,e.ftGetStorageBalance=ne,e.ftGetTokenMetadata=oe,e.ftGetTokensMetadata=ue,e.ftViewFunction=te,e.getAmount=function(e){return new n(e&&t.utils.format.parseNearAmount(e)||"0")},e.getConfig=s,e.getGas=j,e.getHybridStableSmart=at,e.getKeyStore=V,e.getMemorySigner=H,e.getPoolEstimate=it,e.getPoolsByTokens=ut,e.getRatedPoolDetail=ae,e.getRefPools=le,e.getSignedTransactionsByMemoryKey=z,e.getSimplePoolEstimate=tt,e.getStablePoolDecimal=T,e.getStablePoolEstimate=nt,e.getStablePools=ce,e.getStablePoolsThisPair=ot,e.getSwappedAmount=he,e.getTotalPools=re,e.getUnRatedPoolDetail=se,e.instantSwap=ie,e.isStablePool=O,e.isStablePoolToken=N,e.near=X,e.parsePool=x,e.percentLess=R,e.percentOf=E,e.poolFormatter=S,e.provider=Y,e.refFiViewFunction=ee,e.round=P,e.scientificNotationToString=D,e.sendTransactionsByMemoryKey=Q,e.singlePoolSwap=rt,e.toNonDivisibleNumber=F,e.toPrecision=B,e.toReadableNumber=C,e.transformTransactions=G,e.unNamedError=f,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=coinalpha-ref-sdk.umd.production.min.js.map
