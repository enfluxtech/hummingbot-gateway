"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.printCreate2 = void 0;
const utils_1 = require("ethers/lib/utils");
const colors_1 = require("../colors");
const constants_1 = require("../constants");
const utils_2 = require("../utils");
const contract_1 = require("../format/contract");
const gas_cost_1 = require("../format/gas-cost");
async function printCreate2(structLog, index, structLogs, dependencies) {
    const stack = (0, utils_2.shallowCopyStack)(structLog.stack);
    if (stack.length < 4) {
        console.log("Faulty CREATE2");
        return;
    }
    const value = (0, utils_2.parseUint)(stack.pop());
    const codeOffset = (0, utils_2.parseNumber)(stack.pop());
    const codeSize = (0, utils_2.parseNumber)(stack.pop());
    const salt = (0, utils_2.parseUint)(stack.pop());
    const memory = (0, utils_2.parseMemory)(structLog.memory);
    const codeWithArgs = (0, utils_1.hexlify)(memory.slice(codeOffset, codeOffset + codeSize));
    const [structLogNextNext] = (0, utils_2.findNextStructLogInDepth)(structLogs, structLog.depth, index + 1 // find next structLog in the same depth
    );
    const deployedAddress = (0, utils_2.parseAddress)((0, utils_2.shallowCopyStack)(structLogNextNext.stack).pop());
    const str = await (0, contract_1.formatContract)(codeWithArgs, value, salt, deployedAddress, dependencies);
    console.log(constants_1.DEPTH_INDENTATION.repeat(structLog.depth) +
        (0, colors_1.colorLabel)("CREATE2") +
        " " +
        str +
        (0, gas_cost_1.formatGasCost)(structLog, null, dependencies));
    return deployedAddress;
}
exports.printCreate2 = printCreate2;
//# sourceMappingURL=create2.js.map