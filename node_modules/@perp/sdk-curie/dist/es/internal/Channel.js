class e{constructor(e){this._channelRegistry=e,this._eventSourceMap={},this._eventHandlersMap={},this._getEventSourceMap&&(this._eventSourceMap=this._getEventSourceMap())}get hasNoHandlers(){return 0===Object.keys(this._eventHandlersMap).length}on(e,t){var s,n;this._tryRegistryAdd();const r=this._eventSourceMap[e];this._eventHandlersMap[e]=this._eventHandlersMap[e]||[],null===(s=this._eventHandlersMap[e])||void 0===s||s.push(t),null==r||r.callInitEventEmitter(e);return 1===(null===(n=this._eventHandlersMap[e])||void 0===n?void 0:n.length)&&(null==r||r.tryStart(e)),()=>this.off(e,t)}off(e,t){var s,n;this._eventHandlersMap[e]=null===(s=this._eventHandlersMap[e])||void 0===s?void 0:s.filter((e=>e!==t));0===(null===(n=this._eventHandlersMap[e])||void 0===n?void 0:n.length)&&this._tryEventSourceStop(e),this._tryRegistryRemove()}offEvent(e){delete this._eventHandlersMap[e],this._tryEventSourceStop(e),this._tryRegistryRemove()}offAll(){this._eventHandlersMap={},Object.keys(this._eventSourceMap).forEach((e=>{this._tryEventSourceStop(e)})),this._tryRegistryRemove()}once(e,t){const s=(...n)=>{t(...n),this.off(e,s)};this.on(e,s)}emit(e,...t){var s;null===(s=this._eventHandlersMap[e])||void 0===s||s.forEach((e=>{e(...t)}))}getHandlers(e){return this._eventHandlersMap[e]||null}_tryRegistryAdd(){var e;this.hasNoHandlers&&(null===(e=this._channelRegistry)||void 0===e||e.register(this))}_tryRegistryRemove(){var e;this.hasNoHandlers&&(null===(e=this._channelRegistry)||void 0===e||e.unregister(this))}_tryEventSourceStop(e){const t=this._eventSourceMap[e];null==t||t.tryStop(e)}}export{e as Channel};
//# sourceMappingURL=Channel.js.map
