{"version":3,"file":"ChannelEventSource.js","sources":["../../../src/internal/ChannelEventSource.ts"],"sourcesContent":["export type ChannelEventSourceStarter<T> = (eventName: T) => ChannelEventSourceStopper\nexport type ChannelEventSourceStopper = () => void\nexport type ChannelEventSourceInitEmitter<T> = (eventName: T) => void\n\ninterface ChannelEventSourceParams<T> {\n    eventSourceStarter: ChannelEventSourceStarter<T>\n    initEventEmitter?: ChannelEventSourceInitEmitter<T>\n}\n\nexport class ChannelEventSource<EventName extends string = string> {\n    private _eventSourceStarter: ChannelEventSourceStarter<EventName>\n    private _eventSourceStopper?: ChannelEventSourceStopper\n    private _initEventEmitter?: ChannelEventSourceInitEmitter<EventName>\n    private _isServedMap: { [key in EventName]?: boolean } = {}\n\n    get isFirstRequired() {\n        return Object.values(this._isServedMap).every(value => !value)\n    }\n    get isLastRequired() {\n        return Object.values(this._isServedMap).filter(value => value === true).length === 1\n    }\n\n    constructor({ eventSourceStarter, initEventEmitter }: ChannelEventSourceParams<EventName>) {\n        this._eventSourceStarter = eventSourceStarter\n        this._initEventEmitter = initEventEmitter\n    }\n\n    callInitEventEmitter(eventName: EventName) {\n        if (this._initEventEmitter && this.isFirstRequired) {\n            this._initEventEmitter(eventName)\n        }\n    }\n\n    tryStart(eventName: EventName) {\n        if (this.isFirstRequired) {\n            this._eventSourceStopper = this._eventSourceStarter(eventName)\n        }\n        this._isServedMap[eventName] = true\n    }\n\n    tryStop(eventName: EventName) {\n        if (this.isLastRequired && this._eventSourceStopper) {\n            this._eventSourceStopper()\n        }\n        this._isServedMap[eventName] = false\n    }\n}\n"],"names":["ChannelEventSource","constructor","eventSourceStarter","initEventEmitter","this","_isServedMap","_eventSourceStarter","_initEventEmitter","isFirstRequired","Object","values","every","value","isLastRequired","filter","length","callInitEventEmitter","eventName","tryStart","_eventSourceStopper","tryStop"],"mappings":"MASaA,EAaTC,aAAYC,mBAAEA,EAAkBC,iBAAEA,IAT1BC,KAAYC,aAAqC,GAUrDD,KAAKE,oBAAsBJ,EAC3BE,KAAKG,kBAAoBJ,CAC5B,CAVGK,sBACA,OAAOC,OAAOC,OAAON,KAAKC,cAAcM,OAAMC,IAAUA,GAC3D,CACGC,qBACA,OAAmF,IAA5EJ,OAAOC,OAAON,KAAKC,cAAcS,QAAOF,IAAmB,IAAVA,IAAgBG,MAC3E,CAODC,qBAAqBC,GACbb,KAAKG,mBAAqBH,KAAKI,iBAC/BJ,KAAKG,kBAAkBU,EAE9B,CAEDC,SAASD,GACDb,KAAKI,kBACLJ,KAAKe,oBAAsBf,KAAKE,oBAAoBW,IAExDb,KAAKC,aAAaY,IAAa,CAClC,CAEDG,QAAQH,GACAb,KAAKS,gBAAkBT,KAAKe,qBAC5Bf,KAAKe,sBAETf,KAAKC,aAAaY,IAAa,CAClC"}